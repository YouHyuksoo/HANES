# 📋 워크플로우 역질문서 vs 프로젝트 구현 차이 분석 보고서

## 개요
- **문서명**: 06-워크플로우-설계문서 [복구 V1].docx
- **작성일**: 2026-02-23
- **분석 대상**: 사용자가 역질문서에서 선택(■)한 항목과 현재 프로젝트 구현 간의 차이

---

## 1️⃣ WF-01. 자재입하 / PO 관리

| 항목 | 사용자 선택 | 현재 구현 상태 | 차이점 | 우선순위 |
|------|-----------|--------------|--------|---------|
| **Q1-1. 입하 등록 시점** | 별도 입하 절차 불필요 — IQC → 입고만 진행 | `MatArrival`(입하) 엔티티 존재, `ReceivingService`에서 입하→입고 분리 처리 | ⚠️ **부분적 차이** - 코드상 입하/입고가 분리되어 있으나 사용자는 생략 원함 | Medium |
| **Q1-2. 수량 차이 처리** | 허용 오차율 설정 (예: ±5%) 범위 내 자동 허용 | `PurchaseOrder`에 오차율 필드 없음, 수량 체크 로직 없음 | ❌ **미구현** | High |
| **Q1-3. ERP 연동** | ERP에서 PO 정보를 MES로 자동 전송 (MES에서 PO 직접 생성 불가) | `PurchaseOrder` 엔티티 존재, `erpSyncYn` 플래그 있음, 단방향 연동 구조 | ✅ **일치** | - |

### 💡 구현 필요사항
```typescript
// part-master.entity.ts에 오차율 필드 추가 필요
@Column({ name: 'TOLERANCE_RATE', type: 'decimal', precision: 5, scale: 2, default: 5.0 })
toleranceRate: number; // 허용 오차율 (%)
```

---

## 2️⃣ WF-02. IQC (수입검사)

| 항목 | 사용자 선택 | 현재 구현 상태 | 차이점 | 우선순위 |
|------|-----------|--------------|--------|---------|
| **Q2-1. 검사 대상 결정** | 품목마스터의 IQC 구분(무검사/샘플/전수)에 따라 자동 결정 | `PartMaster.iqcYn`(Y/N)만 존재, `IqcGroup.inspectMethod`(FULL/SAMPLE/SKIP)는 별도 테이블 | ⚠️ **부분적 차이** - 품목-그룹 연결(`IqcPartLink`)로 간접 구현 가능 | Medium |
| **Q2-2. 샘플 수량 기준** | 품목별 기준정보에 샘플 수량 지정 | `IqcGroup.sampleQty`에 저장, 품목별 연결은 `IqcPartLink`로 관리 | ✅ **일치** | - |
| **Q2-4. 자재라벨 정보** | 품번/품명, 자재 LOT, MES 시리얼, 입고일/유효기한, 수량, 공급업체 정보 | `MatLot` 엔티티에 모두 존재, `label-template` 모듈 있음 | ✅ **일치** | - |
| **Q2-5. 파괴검사 수량 처리** | 전체 수량 입고, 후 바코드 수량 분할 (A(100) → B(97), C(3)) | `LotSplitController`, `LotMergeController` 존재 | ✅ **일치** | - |
| **Q2-6. 제조사 바코드 매핑** | 바코드 발행 후 MES 라벨과 제조사 바코드 매핑, 매핑 규칙 설정 프로그램 필요 | `VendorBarcodeMapping` 엔티티 완벽 구현 (EXACT/PREFIX/REGEX 지원) | ✅ **일치** | - |

---

## 3️⃣ WF-03. 자재입고

| 항목 | 사용자 선택 | 현재 구현 상태 | 차이점 | 우선순위 |
|------|-----------|--------------|--------|---------|
| **Q3-1. 입고 작업 절차** | 라벨 발행(PC) → 자동입고 → PDA 적치 | `ReceivingService.autoReceive()` 구현됨, PDA 적치는 `mat-stock`에서 관리 | ✅ **일치** | - |
| **Q3-2. 입고 작업 주체** | 자재 담당자가 PC에서 등록 + 창고 담당자가 PDA로 적치 확인 | 권한/역할 분리 로직은 없음, 기능은 구현됨 | ⚠️ **권한 분리 필요** | Medium |
| **Q3-3. 로케이션 지정** | 품목별 고정 로케이션 (기준정보에 설정) | `PartMaster.storageLocation`에 저장됨 | ✅ **일치** | - |
| **Q3-4. 수입품 불량 입고** | IQC 불합격이라도 입고 가능 (불량 상태로 별도 관리) | `MatLot.iqcStatus='FAIL'`도 입고 가능 (분리된 상태 관리) | ✅ **일치** | - |

---

## 4️⃣ WF-04. 자재불출 (출고/이동)

| 항목 | 사용자 선택 | 현재 구현 상태 | 차이점 | 우선순위 |
|------|-----------|--------------|--------|---------|
| **Q4-1. 불출 트리거** | 작업지시 생성 시 BOM 기반 불출요청 자동 생성 → 자재 담당자가 처리 | `MatIssueRequest`, `MatIssue` 엔티티 존재, BOM 기반 생성 로직 있음 | ✅ **일치** | - |
| **Q4-2. 불출 작업 절차** | 불출요청서 바코드 스캔 → 자재 바코드 스캔 → 수량 확인 → 불출 확정 | `scan-issue.dto.ts`에 스캔 기반 불출 정의됨 | ✅ **일치** | - |
| **Q4-3. 자재 수량 처리** | 분할 가능 여부는 품목 기준정보에서 설정 | `PartMaster`에 분할 가능 여부 필드 없음 | ❌ **미구현** | High |
| **Q4-4. 설비 투입 스캔** | 작업자가 설비에 자재 장착 전에 자재 바코드 스캔 | `ProdResult`에 자재 투입 이력 연결 없음 | ❌ **미구현** | High |
| **Q4-5. 모델 변경 시 잔여자재** | 현장 보관 로케이션에 이동 (반납 없음) | 별도 로직 없음 | ❌ **미구현** | Medium |

### 💡 구현 필요사항
```typescript
// part-master.entity.ts
@Column({ name: 'IS_SPLITTABLE', length: 1, default: 'Y' })
isSplittable: string; // 자재 분할 가능 여부
```

---

## 5️⃣ WF-05. 작업지시

| 항목 | 사용자 선택 | 현재 구현 상태 | 차이점 | 우선순위 |
|------|-----------|--------------|--------|---------|
| **Q5-1. 작업지시 생성 단위** | 둘 다 가능 (완제품 기준 자동 + 반제품 단독 생성) | `JobOrderService.createChildOrders()`로 BOM 기반 자동 생성 구현 | ✅ **일치** | - |
| **Q5-2. 작업지시 수량 관계** | 작업지시 수량 이상 생산 불가 (초과 시 차단) | `planQty` 대비 체크 로직 없음 | ❌ **미구현** | High |
| **Q5-3. 복수 작업지시 동시 진행** | 가능 — 같은 설비에서 여러 작업지시 전환 가능 | `JobOrder.status`로 관리, 동시 진행 제어 없음 | ⚠️ **제어 로직 필요** | Medium |
| **Q5-4. 설비부품 인터락** | 작업준비시 설비부품 바코드 스캔하여 미일치시 인터락 | `EquipBom` 엔티티 존재, 인터락 로직 없음 | ❌ **미구현** | High |

---

## 6️⃣ WF-06. 생산실적 입력

| 항목 | 사용자 선택 | 현재 구현 상태 | 차이점 | 우선순위 |
|------|-----------|--------------|--------|---------|
| **Q6-1. 실적 입력 단위** | 품목기준정보에 묶음 수량단위 지정 | `PartMaster.lotUnitQty` 존재 | ✅ **일치** | - |
| **Q6-2. 화면 진입 방식** | 설비 QR 스캔 → 공정에 맞는 입력 화면 자동 표시 | `ProdResultController`에 스캔 기반 접근 정의 | ✅ **일치** | - |
| **Q6-3. 양품/불량 입력** | 생산 수량 입력 → 불량 수량만 별도 입력 → 양품 자동 계산 | `ProdResult.goodQty`, `defectQty` 별도 관리 | ✅ **일치** | - |
| **Q6-4. 자재 투입 확인** | 실적 등록 전 자재 바코드 스캔 필수 | `ProdResult`에 자재 투입 이력 연결 없음 | ❌ **미구현** | High |
| **Q6-5. 설비 조건값 입력** | 자동 로딩 기본, 작업자 수정 가능, 수정 시 확인 메시지 | `work-instruction`에 조건값 저장, 확인 메시지 로직 없음 | ⚠️ **부분적 구현** | Low |

---

## 7️⃣ WF-07. 추적성 라벨 / 시리얼 관리

| 항목 | 사용자 선택 | 현재 구현 상태 | 차이점 | 우선순위 |
|------|-----------|--------------|--------|---------|
| **Q7-1. 시리얼 생성 시점** | 조립 — 반제품 파트가 합쳐져 완제품이 되는 시점 | `TraceLog` 엔티티 존재, 시리얼 생성 시점 제어 없음 | ⚠️ **생성 시점 로직 필요** | Medium |
| **Q7-2. 라벨 발행 시점** | (반)제품 코드가 변경 되는 공정 실적 등록 시 | `label-template` 모듈 있음, 자동 발행 트리거 없음 | ⚠️ **트리거 로직 필요** | Medium |
| **Q7-4. 묶음-개별 시리얼 관계** | 묶음 시리얼은 항상 같은 묶음 단위로 작업 | `lot-split`, `lot-merge`로 구현됨 | ✅ **일치** | - |
| **Q7-5. 반제품→완제품 연결** | 각 반제품 바코드 스캔 → 완제품 시리얼에 자동 연결 | `TraceLog`에 부모-자식 관계 없음 | ❌ **미구현** | High |

### 💡 구현 필요사항
```typescript
// trace-log.entity.ts
@Column({ name: 'PARENT_ID', length: 36, nullable: true })
parentId: string | null;

@ManyToOne(() => TraceLog, { nullable: true })
@JoinColumn({ name: 'PARENT_ID' })
parent: TraceLog | null;
```

---

## 8️⃣ WF-08. 샘플검사 (초물검사)

| 항목 | 사용자 선택 | 현재 구현 상태 | 차이점 | 우선순위 |
|------|-----------|--------------|--------|---------|
| **Q8-1. 샘플검사 절차** | 설비 조건 설정 → 샘플 N개 제작 → 측정 → 합격 시 양산 시작 | `SampleInspectResult` 엔티티 존재 | ✅ **일치** | - |
| **Q8-2. 샘플 검사 수량** | 품목별 기준정보에 지정 | `PartMaster`에 샘플 수량 필드 없음 | ❌ **미구현** | Medium |
| **Q8-3. 측정값 입력** | 우선 수동 키인, 추후 설비 인터페이스 | `sample-inspect-result`에 수동 입력 구현됨 | ✅ **일치** | - |

### 💡 구현 필요사항
```typescript
// part-master.entity.ts
@Column({ name: 'SAMPLE_QTY', type: 'int', nullable: true })
sampleQty: number; // 샘플검사 수량
```

---

## 9️⃣ WF-09. 불량 등록 / 폐기

| 항목 | 사용자 선택 | 현재 구현 상태 | 차이점 | 우선순위 |
|------|-----------|--------------|--------|---------|
| **Q9-1. 불량 등록 절차** | 작업실적 입력 시 불량품 수량 및 유형 입력 | `DefectLog` 엔티티 존재, 실적 입력과 연결됨 | ✅ **일치** | - |
| **Q9-2. 불량 유형 관리** | 공통코드로 불량 유형 관리 | `ComCode` 엔티티로 관리 | ✅ **일치** | - |
| **Q9-3. 불량품 처리 흐름** | 불량 등록 → 라벨 부착 → 격리 → 판정 | `DefectLog` → `RepairLog` → `Scrap` 흐름 있음 | ✅ **일치** | - |
| **Q9-4. 폐기 시 재고 처리** | 불량품도 자재 투입 이력 남김 | `TraceLog`로 추적 가능 | ✅ **일치** | - |

---

## 🔟 WF-10. 외관검사

| 항목 | 사용자 선택 | 현재 구현 상태 | 차이점 | 우선순위 |
|------|-----------|--------------|--------|---------|
| **Q10-1. 검사 범위** | 전수검사 (모든 완성품) | `InspectResult`에 검사 유형 필드 없음 | ⚠️ **검사 유형 구분 필요** | Low |
| **Q10-2. 입력 방식** | 제품 바코드 스캔 → 합격/불합격 판정 | `InspectResult` 엔티티 존재, 바코드 스캔 연동 없음 | ⚠️ **스캔 연동 필요** | Medium |
| **불합격 사유** | 코드화 하여 선택, 복수 선택 및 직접입력 | `defect-log`에 불량 유형 관리됨 | ✅ **일치** | - |

---

## 1️⃣1️⃣~1️⃣6️⃣ 기타 워크플로우 요약

| 워크플로우 | 사용자 선택 | 구현 상태 | 차이점 |
|----------|----------|----------|--------|
| **WF-11. 제품포장** | 박스/대차 바코드 스캔 기반 포장, 과포장 방지 | `BoxMaster`, `PalletMaster` 구현됨 | ✅ **일치** |
| **WF-12. 제품창고** | 포장 완료 → 이동 → 입고 확정 | `ProductStock`, `ProductTransaction` 구현됨 | ✅ **일치** |
| **WF-13. 출하** | 출하지시서 바코드 스캔 → 제품 스캔 → 작업자 스캔 | `ShipmentOrder`, `ShipmentLog` 구현됨 | ✅ **일치** |
| **WF-14. 출하반품** | 반품 시 폐기 | `ShipmentReturn` 엔티티 존재 | ✅ **일치** |
| **WF-15. 재작업** | 고객사 재작업 없음 | `RepairLog` 존재하나 로직 단순화됨 | ✅ **일치** |
| **WF-16. 바코드/PDA** | 모든 설비 바코드 스캔 필요, Buffered Mode | `VendorBarcodeMapping` 구현됨 | ✅ **일치** |

---

## 📊 종합 평가

### ✅ 완벽 구현된 항목 (14개)
- PO 관리, ERP 연동
- IQC 검사 기준정보, 제조사 바코드 매핑
- LOT 분할/병합
- 작업지시 BOM 기반 생성
- 샘플검사 이력 관리
- 불량/폐기 흐름
- 제품포장, 제품창고, 출하, 반품

### ⚠️ 부분 구현 또는 개선 필요 (8개)
| 항목 | 설명 | 우선순위 |
|------|------|---------|
| 입하 절차 생략 옵션 | IQC 후 자동 입고 설정 | Medium |
| IQC 구분 자동 결정 로직 | 품목-그룹 연결 자동화 | Medium |
| 작업지시 수량 초과 차단 | 생산 실적 입력 시 체크 | High |
| 설비부품 인터락 | 설비 BOM과 작업지시 연결 | High |
| 라벨 발행 자동 트리거 | 공정 코드 변경 시 자동 발행 | Medium |
| 외관검사 바코드 연동 | 스캔 기반 검사 입력 | Medium |

### ❌ 미구현 항목 (5개) - 개발 필요

| # | 항목 | 설명 | 예상 소요시간 |
|---|------|------|--------------|
| 1 | **PO 수량 오차율 허용 설정** | `PartMaster.toleranceRate` 필드 필요 | 1일 |
| 2 | **자재 분할 가능 여부 설정** | `PartMaster.isSplittable` 필드 필요 | 1일 |
| 3 | **설비 투입 자재 스캔 확인** | `ProdResult`와 자재 투입 이력 연결 필요 | 2일 |
| 4 | **반제품→완제품 시리얼 연결** | `TraceLog` 부모-자식 관계 필요 | 2일 |
| 5 | **샘플검사 수량 품목별 설정** | `PartMaster.sampleQty` 필드 필요 | 1일 |

---

## 🔧 개발 작업 목록

### 엔티티 마이그레이션 필요
```sql
-- PART_MASTERS 테이블에 추가 필요
ALTER TABLE PART_MASTERS ADD (
  TOLERANCE_RATE NUMBER(5,2) DEFAULT 5.0,  -- 허용 오차율
  IS_SPLITTABLE VARCHAR2(1) DEFAULT 'Y',    -- 분할 가능 여부
  SAMPLE_QTY NUMBER(10)                     -- 샘플검사 수량
);

-- TRACE_LOGS 테이블에 추가 필요
ALTER TABLE TRACE_LOGS ADD (
  PARENT_ID VARCHAR2(36)                    -- 부모 시리얼 ID
);
```

### 서비스 로직 개발 필요
1. `ReceivingService` - 오차율 체크 로직
2. `JobOrderService` - 수량 초과 차단 로직
3. `ProdResultService` - 자재 투입 스캔 연동
4. `EquipBomService` - 설비부품 인터락 로직
5. `LabelTemplateService` - 자동 발행 트리거

---

*작성일: 2026-02-24*
*분석자: AI Assistant*
